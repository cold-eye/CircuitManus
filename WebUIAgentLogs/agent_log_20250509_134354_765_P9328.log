2025-05-09 13:43:54,766 - CircuitManusCore - INFO [CircuitManusCore.<module>:81] - Successfully configured file logging. Log messages will also be saved to: D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\WebUIAgentLogs\agent_log_20250509_134354_765_P9328.log
2025-05-09 13:43:54,766 - __mp_main__ - INFO [server.<module>:21] - CircuitAgent 模块导入成功。
2025-05-09 13:43:54,767 - __mp_main__ - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功。
2025-05-09 13:43:54,767 - __mp_main__ - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量。
2025-05-09 13:43:54,810 - asyncio - DEBUG [selector_events.__init__:54] - Using selector: SelectSelector
2025-05-09 13:43:54,880 - server - INFO [server.<module>:21] - CircuitAgent 模块导入成功。
2025-05-09 13:43:54,880 - server - INFO [server.<module>:45] - 静态文件目录 '/static' 挂载成功。
2025-05-09 13:43:54,880 - server - INFO [server.<module>:60] - 成功获取 ZHIPUAI_API_KEY 环境变量。
2025-05-09 13:43:55,849 - server - INFO [server.read_root:96] - 请求根路径 '/'，尝试提供 static/index.html。
2025-05-09 13:43:59,213 - server - INFO [server.websocket_endpoint:117] - WebSocket 连接已接受 (来自: 127.0.0.1:57556).
2025-05-09 13:43:59,272 - server - INFO [server.websocket_endpoint:144] - 收到WebSocket初始化消息，未提供session_id，生成新的: b993d5e8-120d-498f-a9c2-0793899d46e7
2025-05-09 13:43:59,272 - server - INFO [server.get_agent_instance:67] - 为 Session b993d5e8-120d-498f-a9c2-0793899d46e7 创建新的 Agent 实例...
2025-05-09 13:43:59,272 - CircuitManusCore - INFO [CircuitManusCore.__init__:591] - 
============================== CircuitAgent V7.2.3 初始化开始 (WebSocket 集成) ==============================
2025-05-09 13:43:59,272 - CircuitManusCore - INFO [CircuitManusCore.__init__:597] - [Agent Init] 控制台日志级别设置为: DEBUG (Verbose=True)
2025-05-09 13:43:59,272 - CircuitManusCore - INFO [CircuitManusCore.__init__:237] - [MemoryManager] 初始化记忆模块...
2025-05-09 13:43:59,273 - CircuitManusCore - INFO [CircuitManusCore.__init__:115] - [Circuit] 初始化电路实体。
2025-05-09 13:43:59,273 - CircuitManusCore - INFO [CircuitManusCore.__init__:122] - [Circuit] 电路实体初始化完成。
2025-05-09 13:43:59,273 - CircuitManusCore - INFO [CircuitManusCore.__init__:244] - [MemoryManager] 记忆模块初始化完成。短期上限: 25 条, 长期上限: 50 条。
2025-05-09 13:43:59,273 - CircuitManusCore - INFO [CircuitManusCore.__init__:293] - [LLMInterface] 初始化 LLM 接口，目标模型: glm-4-flash-250414
2025-05-09 13:43:59,398 - CircuitManusCore - INFO [CircuitManusCore.__init__:301] - [LLMInterface] 智谱 AI 客户端初始化成功。
2025-05-09 13:43:59,399 - CircuitManusCore - INFO [CircuitManusCore.__init__:308] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.1, MaxTokens: 4095)。
2025-05-09 13:43:59,399 - CircuitManusCore - INFO [CircuitManusCore.__init__:348] - [OutputParser] 初始化输出解析器 (用于自定义 JSON 和文本解析)。
2025-05-09 13:43:59,399 - CircuitManusCore - INFO [CircuitManusCore.__init__:476] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止)。
2025-05-09 13:43:59,400 - CircuitManusCore - INFO [CircuitManusCore.__init__:484] - [ToolExecutor] 工具执行配置: 每个工具最多重试 10 次，重试间隔 1.0 秒。Verbose Mode: True
2025-05-09 13:43:59,400 - CircuitManusCore - INFO [CircuitManusCore.__init__:609] - [Agent Init] 规划 LLM 调用失败时将重试 5 次。
2025-05-09 13:43:59,400 - CircuitManusCore - INFO [CircuitManusCore.__init__:610] - [Agent Init] 工具执行失败后，最多允许重规划 2 次。
2025-05-09 13:43:59,400 - CircuitManusCore - INFO [CircuitManusCore.__init__:612] - [Agent Init] 正在动态发现并注册已标记的工具...
2025-05-09 13:43:59,401 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'add_component_tool'
2025-05-09 13:43:59,401 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-09 13:43:59,401 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-09 13:43:59,402 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-09 13:43:59,402 - CircuitManusCore - INFO [CircuitManusCore.__init__:621] - [Agent Init] 共发现并注册了 4 个工具。
2025-05-09 13:43:59,402 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:623] - [Agent Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等)。如果用户未指定 ID，会自动生成。",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID。"
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来。",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID。"
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID。"
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-09 13:43:59,403 - CircuitManusCore - INFO [CircuitManusCore.__init__:625] - 
============================== CircuitAgent V7.2.3 初始化成功 ==============================

2025-05-09 13:43:59,403 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session b993d5e8-120d-498f-a9c2-0793899d46e7 创建成功。
2025-05-09 13:43:59,403 - server - INFO [server.websocket_endpoint:160] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 WebSocket初始化成功并发送确认。
2025-05-09 13:44:42,906 - server - INFO [server.websocket_endpoint:179] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 收到用户消息: '请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定...'
2025-05-09 13:44:42,907 - server - INFO [server.websocket_endpoint:183] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 获取到锁，开始处理消息...
2025-05-09 13:44:42,907 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:751] - 
========================= CircuitAgent V7.2.3 开始处理用户请求 =========================
2025-05-09 13:44:42,907 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:752] - [Orchestrator] 收到用户指令: "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
2025-05-09 13:44:42,907 - CircuitManusCore - DEBUG [CircuitManusCore.add_to_short_term:247] - [MemoryManager] 添加消息到短期记忆 (Role: user). 当前数量: 0
2025-05-09 13:44:42,908 - CircuitManusCore - DEBUG [CircuitManusCore.add_to_short_term:263] - [MemoryManager] 添加后短期记忆数量: 1
2025-05-09 13:44:42,908 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:762] - [Orchestrator] 用户指令已记录并添加到短期记忆。
2025-05-09 13:44:42,908 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:769] - 
--- [规划/重规划阶段] 尝试第 1/3 次规划 ---
2025-05-09 13:44:42,909 - server - DEBUG [server.send_status_update_to_client:126] - SERVER SENDING TO CLIENT (Session b993d5e8-120d-498f-a9c2-0793899d46e7): {"type": "status", "stage": "planning", "status": "started", "message": "\u5f00\u59cb\u89c4\u5212\u4efb\u52a1...", "details": {"attempt": 1}}
2025-05-09 13:44:42,910 - CircuitManusCore - DEBUG [CircuitManusCore.get_memory_context_for_prompt:276] - [MemoryManager] 正在格式化记忆上下文用于 Prompt...
2025-05-09 13:44:42,910 - CircuitManusCore - DEBUG [CircuitManusCore.get_state_description:167] - [Circuit] 正在生成电路状态描述...
2025-05-09 13:44:42,910 - CircuitManusCore - DEBUG [CircuitManusCore.get_memory_context_for_prompt:287] - [MemoryManager] 记忆上下文 (电路+长期) 格式化完成。
2025-05-09 13:44:42,910 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 1/6)...
2025-05-09 13:44:42,910 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:44:42,910 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:44:42,911 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:44:42,915 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:44:44,954 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:44:45,841 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:44:47,899 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:44:49,583 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:44:51,631 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:44:55,292 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:44:57,319 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:44:57,320 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:44:57,340 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:44:57,342 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 2/6)...
2025-05-09 13:44:57,342 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:44:57,342 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:44:57,342 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:44:57,343 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:44:59,361 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:00,135 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:02,189 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:03,747 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:05,798 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:09,115 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:09,883 - server - INFO [server.read_root:96] - 请求根路径 '/'，尝试提供 static/index.html。
2025-05-09 13:45:10,085 - server - INFO [server.websocket_endpoint:117] - WebSocket 连接已接受 (来自: 127.0.0.1:57649).
2025-05-09 13:45:10,133 - server - INFO [server.websocket_endpoint:144] - 收到WebSocket初始化消息，未提供session_id，生成新的: 8c819722-68d0-4deb-8395-d64688ce080b
2025-05-09 13:45:10,134 - server - INFO [server.get_agent_instance:67] - 为 Session 8c819722-68d0-4deb-8395-d64688ce080b 创建新的 Agent 实例...
2025-05-09 13:45:10,134 - CircuitManusCore - INFO [CircuitManusCore.__init__:591] - 
============================== CircuitAgent V7.2.3 初始化开始 (WebSocket 集成) ==============================
2025-05-09 13:45:10,134 - CircuitManusCore - INFO [CircuitManusCore.__init__:597] - [Agent Init] 控制台日志级别设置为: DEBUG (Verbose=True)
2025-05-09 13:45:10,134 - CircuitManusCore - INFO [CircuitManusCore.__init__:237] - [MemoryManager] 初始化记忆模块...
2025-05-09 13:45:10,134 - CircuitManusCore - INFO [CircuitManusCore.__init__:115] - [Circuit] 初始化电路实体。
2025-05-09 13:45:10,135 - CircuitManusCore - INFO [CircuitManusCore.__init__:122] - [Circuit] 电路实体初始化完成。
2025-05-09 13:45:10,135 - CircuitManusCore - INFO [CircuitManusCore.__init__:244] - [MemoryManager] 记忆模块初始化完成。短期上限: 25 条, 长期上限: 50 条。
2025-05-09 13:45:10,135 - CircuitManusCore - INFO [CircuitManusCore.__init__:293] - [LLMInterface] 初始化 LLM 接口，目标模型: glm-4-flash-250414
2025-05-09 13:45:10,170 - CircuitManusCore - INFO [CircuitManusCore.__init__:301] - [LLMInterface] 智谱 AI 客户端初始化成功。
2025-05-09 13:45:10,170 - CircuitManusCore - INFO [CircuitManusCore.__init__:308] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.1, MaxTokens: 4095)。
2025-05-09 13:45:10,171 - CircuitManusCore - INFO [CircuitManusCore.__init__:348] - [OutputParser] 初始化输出解析器 (用于自定义 JSON 和文本解析)。
2025-05-09 13:45:10,171 - CircuitManusCore - INFO [CircuitManusCore.__init__:476] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止)。
2025-05-09 13:45:10,171 - CircuitManusCore - INFO [CircuitManusCore.__init__:484] - [ToolExecutor] 工具执行配置: 每个工具最多重试 10 次，重试间隔 1.0 秒。Verbose Mode: True
2025-05-09 13:45:10,171 - CircuitManusCore - INFO [CircuitManusCore.__init__:609] - [Agent Init] 规划 LLM 调用失败时将重试 5 次。
2025-05-09 13:45:10,172 - CircuitManusCore - INFO [CircuitManusCore.__init__:610] - [Agent Init] 工具执行失败后，最多允许重规划 2 次。
2025-05-09 13:45:10,172 - CircuitManusCore - INFO [CircuitManusCore.__init__:612] - [Agent Init] 正在动态发现并注册已标记的工具...
2025-05-09 13:45:10,172 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'add_component_tool'
2025-05-09 13:45:10,172 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-09 13:45:10,172 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-09 13:45:10,173 - CircuitManusCore - INFO [CircuitManusCore.__init__:617] - [Agent Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-09 13:45:10,173 - CircuitManusCore - INFO [CircuitManusCore.__init__:621] - [Agent Init] 共发现并注册了 4 个工具。
2025-05-09 13:45:10,173 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:623] - [Agent Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等)。如果用户未指定 ID，会自动生成。",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID。"
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来。",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID。"
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID。"
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-09 13:45:10,174 - CircuitManusCore - INFO [CircuitManusCore.__init__:625] - 
============================== CircuitAgent V7.2.3 初始化成功 ==============================

2025-05-09 13:45:10,174 - server - INFO [server.get_agent_instance:74] - Agent 实例为 Session 8c819722-68d0-4deb-8395-d64688ce080b 创建成功。
2025-05-09 13:45:10,175 - server - INFO [server.websocket_endpoint:160] - Session 8c819722-68d0-4deb-8395-d64688ce080b WebSocket初始化成功并发送确认。
2025-05-09 13:45:11,170 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:11,171 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:11,174 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:11,176 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 3/6)...
2025-05-09 13:45:11,176 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:45:11,176 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:45:11,176 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:45:11,178 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:13,228 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:14,050 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:16,105 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:17,714 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:19,765 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:23,435 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:25,491 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:25,492 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:25,497 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:25,499 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 4/6)...
2025-05-09 13:45:25,500 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:45:25,500 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:45:25,500 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:45:25,501 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:27,518 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:28,359 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:30,401 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:32,222 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:34,272 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:38,012 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:40,063 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:40,065 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:40,068 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:40,070 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 5/6)...
2025-05-09 13:45:40,071 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:45:40,071 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:45:40,071 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:45:40,072 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:42,119 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:43,053 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:45,102 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:45,573 - server - INFO [server.websocket_endpoint:179] - Session 8c819722-68d0-4deb-8395-d64688ce080b 收到用户消息: '请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定...'
2025-05-09 13:45:45,573 - server - INFO [server.websocket_endpoint:183] - Session 8c819722-68d0-4deb-8395-d64688ce080b 获取到锁，开始处理消息...
2025-05-09 13:45:45,573 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:751] - 
========================= CircuitAgent V7.2.3 开始处理用户请求 =========================
2025-05-09 13:45:45,573 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:752] - [Orchestrator] 收到用户指令: "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
2025-05-09 13:45:45,573 - CircuitManusCore - DEBUG [CircuitManusCore.add_to_short_term:247] - [MemoryManager] 添加消息到短期记忆 (Role: user). 当前数量: 0
2025-05-09 13:45:45,573 - CircuitManusCore - DEBUG [CircuitManusCore.add_to_short_term:263] - [MemoryManager] 添加后短期记忆数量: 1
2025-05-09 13:45:45,574 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:762] - [Orchestrator] 用户指令已记录并添加到短期记忆。
2025-05-09 13:45:45,574 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:769] - 
--- [规划/重规划阶段] 尝试第 1/3 次规划 ---
2025-05-09 13:45:45,574 - server - DEBUG [server.send_status_update_to_client:126] - SERVER SENDING TO CLIENT (Session 8c819722-68d0-4deb-8395-d64688ce080b): {"type": "status", "stage": "planning", "status": "started", "message": "\u5f00\u59cb\u89c4\u5212\u4efb\u52a1...", "details": {"attempt": 1}}
2025-05-09 13:45:45,574 - CircuitManusCore - DEBUG [CircuitManusCore.get_memory_context_for_prompt:276] - [MemoryManager] 正在格式化记忆上下文用于 Prompt...
2025-05-09 13:45:45,574 - CircuitManusCore - DEBUG [CircuitManusCore.get_state_description:167] - [Circuit] 正在生成电路状态描述...
2025-05-09 13:45:45,575 - CircuitManusCore - DEBUG [CircuitManusCore.get_memory_context_for_prompt:287] - [MemoryManager] 记忆上下文 (电路+长期) 格式化完成。
2025-05-09 13:45:45,575 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 1/6)...
2025-05-09 13:45:45,575 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:45:45,575 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:45:45,575 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:45:45,576 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:46,688 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:47,618 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:48,399 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:48,725 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:50,452 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:52,130 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:52,399 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:54,179 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:54,180 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:54,182 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:45:54,184 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 6/6)...
2025-05-09 13:45:54,184 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:45:54,184 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:45:54,184 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:45:54,185 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:54,444 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:56,223 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:45:57,015 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:57,983 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:45:59,071 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:00,037 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:00,038 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:00,041 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:00,042 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 2/6)...
2025-05-09 13:46:00,043 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:46:00,043 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:46:00,043 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:46:00,044 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:00,989 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:02,077 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:03,027 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:03,041 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:05,074 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:06,260 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57451 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:07,007 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:08,312 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:08,314 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:08,318 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:08,322 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:812] - [Orchestrator - Planning Attempt 1] 规划失败：所有 LLM 调用尝试后，未能获取有效 JSON 计划。最终解析错误: LLM 调用或响应解析时发生错误: Connection error.
2025-05-09 13:46:08,322 - server - DEBUG [server.send_status_update_to_client:126] - SERVER SENDING TO CLIENT (Session b993d5e8-120d-498f-a9c2-0793899d46e7): {"type": "status", "stage": "planning", "status": "error", "message": "\u89c4\u5212\u5931\u8d25 (\u5c1d\u8bd5 1): \u672a\u80fd\u83b7\u53d6\u6709\u6548\u8ba1\u5212\u3002", "details": {"error": "LLM \u8c03\u7528\u6216\u54cd\u5e94\u89e3\u6790\u65f6\u53d1\u751f\u9519\u8bef: Connection error.", "thinking": "\u672a\u80fd\u63d0\u53d6\u601d\u8003\u8fc7\u7a0b (\u521d\u59cb)\u3002"}}
2025-05-09 13:46:08,322 - server - WARNING [server.send_status_update_to_client:129] - 尝试发送状态更新到 Session b993d5e8-120d-498f-a9c2-0793899d46e7 时WebSocket已断开。
2025-05-09 13:46:08,323 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:1010] - 
========================= CircuitAgent V7.2.3 请求处理完毕 (总耗时: 85.422 秒) =========================

2025-05-09 13:46:08,323 - server - WARNING [server.websocket_endpoint:191] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 Agent消息处理任务被取消。
2025-05-09 13:46:08,323 - server - INFO [server.websocket_endpoint:201] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 释放锁。
2025-05-09 13:46:08,323 - server - CRITICAL [server.websocket_endpoint:230] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 WebSocket连接处理发生顶层未预期异常: WebSocket is not connected. Need to call "accept" first.
Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\server.py", line 135, in websocket_endpoint
    data = await websocket.receive_text()
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\starlette\websockets.py", line 117, in receive_text
    raise RuntimeError('WebSocket is not connected. Need to call "accept" first.')
RuntimeError: WebSocket is not connected. Need to call "accept" first.
2025-05-09 13:46:08,325 - server - INFO [server.websocket_endpoint:237] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 的WebSocket连接已从活动列表中移除。
2025-05-09 13:46:08,326 - server - INFO [server.websocket_endpoint:238] - Session b993d5e8-120d-498f-a9c2-0793899d46e7 WebSocket连接处理结束 (客户端: 127.0.0.1:57556).
2025-05-09 13:46:09,061 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:12,813 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:14,845 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:14,846 - CircuitManusCore - ERROR [CircuitManusCore.call_llm:343] - [LLMInterface] LLM API 异步调用失败: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:14,849 - CircuitManusCore - ERROR [CircuitManusCore.process_user_request:806] - [Orchestrator - Planning Attempt 1] LLM 调用或规划解析过程中发生严重错误: Connection error.
Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 256, in handle_request
    raise exc from None
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\http_proxy.py", line 288, in handle_request
    connect_response = self._connection.handle_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 101, in handle_request
    raise exc
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 78, in handle_request
    stream = self._connect(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_sync\connection.py", line 124, in _connect
    stream = self._network_backend.connect_tcp(**kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_backends\sync.py", line 207, in connect_tcp
    with map_exceptions(exc_map):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 520, in _request
    response = self._client.send(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 249, in handle_request
    with map_httpcore_exceptions():
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\contextlib.py", line 153, in __exit__
    self.gen.throw(typ, value, traceback)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ConnectError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 785, in process_user_request
    llm_response_for_planning = await self.llm_interface.call_llm(messages=messages_for_llm_planning, use_tools=False)
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\CircuitManusCore.py", line 328, in call_llm
    response = await asyncio.to_thread(self.client.chat.completions.create, **call_args)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\api_resource\chat\completions.py", line 96, in create
    return self._post(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 809, in post
    return cast(ResponseT, self.request(cast_type, opts, stream=stream, stream_cls=stream_cls))
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 495, in request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 544, in _request
    return self._retry_request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 622, in _retry_request
    return self._request(
  File "d:\ProgramData\anaconda3\envs\IDTAgent\lib\site-packages\zhipuai\core\_http_client.py", line 554, in _request
    raise APIConnectionError(request=request) from err
zhipuai.core._errors.APIConnectionError: Connection error.
2025-05-09 13:46:14,851 - CircuitManusCore - INFO [CircuitManusCore.process_user_request:783] - [Orchestrator - Planning Attempt 1] 调用规划 LLM (LLM Call Attempt 3/6)...
2025-05-09 13:46:14,851 - CircuitManusCore - INFO [CircuitManusCore.call_llm:315] - [LLMInterface] 准备异步调用 LLM (glm-4-flash-250414，自定义 JSON/无内置工具模式)...
2025-05-09 13:46:14,851 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:316] - [LLMInterface] 发送的消息条数: 2
2025-05-09 13:46:14,851 - CircuitManusCore - DEBUG [CircuitManusCore.call_llm:320] - [LLMInterface] 最新消息列表 (预览): 
[
  {
    "role": "system",
    "content_preview": "你是一位顶尖的、极其严谨的电路设计编程助理。你的行为必须专业、精确，并严格遵循指令。\n你的核心任务是：深入分析用户的最新指令、完整的对话历史（包括你之前的思考、规划以及所有工具执行结果），以及当前的电..."
  },
  {
    "role": "user",
    "content_preview": "请你设计一个简单的滤波电路 并且将原件连接起来 参数你自己决定"
  }
]
2025-05-09 13:46:14,853 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:16,872 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:17,744 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:19,783 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:21,588 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
2025-05-09 13:46:23,615 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.failed exception=ConnectError(ConnectionRefusedError(10061, '由于目标计算机积极拒绝，无法连接。', None, 10061, None))
2025-05-09 13:46:26,654 - httpcore.connection - DEBUG [_trace.trace:47] - connect_tcp.started host='127.0.0.1' port=57566 local_address=None timeout=8.0 socket_options=None
