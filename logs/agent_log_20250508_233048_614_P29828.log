2025-05-08 23:30:48,616 - CircuitManusCore - INFO [CircuitManusCore.<module>:84] - Successfully configured file logging. Log messages will also be saved to: D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\agent_logs\agent_log_20250508_233048_614_P29828.log
2025-05-08 23:30:48,621 - __mp_main__ - INFO [server.<module>:41] - 静态文件目录 '/static' 挂载成功。
2025-05-08 23:30:48,622 - __mp_main__ - INFO [server.<module>:57] - 成功获取 ZHIPUAI_API_KEY 环境变量。
2025-05-08 23:30:48,690 - asyncio - DEBUG [selector_events.__init__:54] - Using selector: SelectSelector
2025-05-08 23:30:48,751 - server - INFO [server.<module>:41] - 静态文件目录 '/static' 挂载成功。
2025-05-08 23:30:48,753 - server - INFO [server.<module>:57] - 成功获取 ZHIPUAI_API_KEY 环境变量。
2025-05-08 23:31:03,150 - server - INFO [server.process_chat_message:104] - [Request:c039d053] 收到消息。Session: 0550f939-4e3a-4894-a936-b5984a952520, Message: '你能为我做什么...'
2025-05-08 23:31:03,150 - server - INFO [server.get_agent_instance:62] - 为 Session 0550f939-4e3a-4894-a936-b5984a952520 创建新的 Agent 实例...
2025-05-08 23:31:03,151 - CircuitManusCore - INFO [CircuitManusCore.__init__:821] - 
============================== Agent V7.2.2 初始化开始 (Async, Decorator Tools, File Logging, Enhanced Q&A, Verbose Switch) ==============================
2025-05-08 23:31:03,151 - CircuitManusCore - INFO [CircuitManusCore.__init__:822] - [Agent Init] 正在启动电路设计助理 V7.2.2...
2025-05-08 23:31:03,152 - CircuitManusCore - INFO [CircuitManusCore.__init__:831] - [Agent Init] 控制台日志级别设置为: DEBUG (Verbose=True)
2025-05-08 23:31:03,152 - CircuitManusCore - INFO [CircuitManusCore.__init__:294] - [MemoryManager] 初始化记忆模块...
2025-05-08 23:31:03,153 - CircuitManusCore - INFO [CircuitManusCore.__init__:134] - [Circuit] 初始化电路实体。
2025-05-08 23:31:03,153 - CircuitManusCore - INFO [CircuitManusCore.__init__:141] - [Circuit] 电路实体初始化完成。
2025-05-08 23:31:03,154 - CircuitManusCore - INFO [CircuitManusCore.__init__:303] - [MemoryManager] 记忆模块初始化完成。短期上限: 25 条, 长期上限: 50 条。
2025-05-08 23:31:03,154 - CircuitManusCore - INFO [CircuitManusCore.__init__:363] - [LLMInterface] 初始化 LLM 接口，目标模型: glm-4-flash-250414
2025-05-08 23:31:03,259 - CircuitManusCore - INFO [CircuitManusCore.__init__:372] - [LLMInterface] 智谱 AI 客户端初始化成功。
2025-05-08 23:31:03,260 - CircuitManusCore - INFO [CircuitManusCore.__init__:379] - [LLMInterface] LLM 接口初始化完成 (Model: glm-4-flash-250414, Temp: 0.1, MaxTokens: 4095)。
2025-05-08 23:31:03,260 - CircuitManusCore - INFO [CircuitManusCore.__init__:479] - [OutputParser] 初始化输出解析器 (用于自定义 JSON 和文本解析)。
2025-05-08 23:31:03,260 - CircuitManusCore - INFO [CircuitManusCore.__init__:664] - [ToolExecutor] 初始化工具执行器 (支持异步, 重试, 失败中止)。
2025-05-08 23:31:03,260 - CircuitManusCore - INFO [CircuitManusCore.__init__:675] - [ToolExecutor] 工具执行配置: 每个工具最多重试 2 次，重试间隔 1.0 秒。Verbose Mode: True
2025-05-08 23:31:03,262 - CircuitManusCore - INFO [CircuitManusCore.__init__:852] - [Agent Init] 规划 LLM 调用失败时将重试 1 次。
2025-05-08 23:31:03,262 - CircuitManusCore - INFO [CircuitManusCore.__init__:853] - [Agent Init] 工具执行失败后，最多允许重规划 2 次。
2025-05-08 23:31:03,262 - CircuitManusCore - INFO [CircuitManusCore.__init__:856] - [Agent Init] 正在动态发现并注册已标记的工具...
2025-05-08 23:31:03,263 - CircuitManusCore - INFO [CircuitManusCore.__init__:862] - [Agent Init] ✓ 已注册工具: 'add_component_tool'
2025-05-08 23:31:03,263 - CircuitManusCore - INFO [CircuitManusCore.__init__:862] - [Agent Init] ✓ 已注册工具: 'clear_circuit_tool'
2025-05-08 23:31:03,264 - CircuitManusCore - INFO [CircuitManusCore.__init__:862] - [Agent Init] ✓ 已注册工具: 'connect_components_tool'
2025-05-08 23:31:03,264 - CircuitManusCore - INFO [CircuitManusCore.__init__:862] - [Agent Init] ✓ 已注册工具: 'describe_circuit_tool'
2025-05-08 23:31:03,265 - CircuitManusCore - INFO [CircuitManusCore.__init__:868] - [Agent Init] 共发现并注册了 4 个工具。
2025-05-08 23:31:03,266 - CircuitManusCore - DEBUG [CircuitManusCore.__init__:871] - [Agent Init] 工具注册表详情:
{
  "add_component_tool": {
    "description": "添加一个新的电路元件 (如电阻, 电容, 电池, LED, 开关, 芯片, 地线等)。如果用户未指定 ID，会自动生成。",
    "parameters": {
      "type": "object",
      "properties": {
        "component_type": {
          "type": "string",
          "description": "元件的类型 (例如: '电阻', 'LED')."
        },
        "component_id": {
          "type": "string",
          "description": "可选的用户指定 ID。"
        },
        "value": {
          "type": "string",
          "description": "可选的元件值 (例如: '1k', '10uF')."
        }
      },
      "required": [
        "component_type"
      ]
    }
  },
  "clear_circuit_tool": {
    "description": "彻底清空当前的电路设计。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  },
  "connect_components_tool": {
    "description": "使用两个已存在元件的 ID 将它们连接起来。",
    "parameters": {
      "type": "object",
      "properties": {
        "comp1_id": {
          "type": "string",
          "description": "第一个元件的 ID。"
        },
        "comp2_id": {
          "type": "string",
          "description": "第二个元件的 ID。"
        }
      },
      "required": [
        "comp1_id",
        "comp2_id"
      ]
    }
  },
  "describe_circuit_tool": {
    "description": "获取当前电路的详细描述。",
    "parameters": {
      "type": "object",
      "properties": {}
    }
  }
}
2025-05-08 23:31:03,268 - CircuitManusCore - INFO [CircuitManusCore.__init__:874] - 
============================== Agent V7.2.2 初始化成功 ==============================

2025-05-08 23:31:03,271 - server - INFO [server.get_agent_instance:70] - Agent 实例为 Session 0550f939-4e3a-4894-a936-b5984a952520 创建成功。
2025-05-08 23:31:03,271 - server - INFO [server.process_chat_message:123] - [Request:c039d053] 开始处理 Session 0550f939-4e3a-4894-a936-b5984a952520 的消息...
2025-05-08 23:31:03,272 - server - ERROR [server.process_chat_message:131] - [Request:c039d053] 处理 Session 0550f939-4e3a-4894-a936-b5984a952520 消息时发生内部错误: name 'time' is not defined
Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\server.py", line 125, in process_chat_message
    start_time = time.monotonic()
NameError: name 'time' is not defined
2025-05-08 23:31:38,888 - server - INFO [server.read_root:138] - 请求根路径 '/'，尝试提供 index.html。
2025-05-08 23:31:44,977 - server - INFO [server.process_chat_message:104] - [Request:49eef67e] 收到消息。Session: 0550f939-4e3a-4894-a936-b5984a952520, Message: '你是谁？...'
2025-05-08 23:31:44,978 - server - INFO [server.process_chat_message:123] - [Request:49eef67e] 开始处理 Session 0550f939-4e3a-4894-a936-b5984a952520 的消息...
2025-05-08 23:31:44,979 - server - ERROR [server.process_chat_message:131] - [Request:49eef67e] 处理 Session 0550f939-4e3a-4894-a936-b5984a952520 消息时发生内部错误: name 'time' is not defined
Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\server.py", line 125, in process_chat_message
    start_time = time.monotonic()
NameError: name 'time' is not defined
2025-05-08 23:32:14,168 - server - INFO [server.process_chat_message:104] - [Request:955f5dab] 收到消息。Session: 0550f939-4e3a-4894-a936-b5984a952520, Message: '你哪位？...'
2025-05-08 23:32:14,168 - server - INFO [server.process_chat_message:123] - [Request:955f5dab] 开始处理 Session 0550f939-4e3a-4894-a936-b5984a952520 的消息...
2025-05-08 23:32:14,169 - server - ERROR [server.process_chat_message:131] - [Request:955f5dab] 处理 Session 0550f939-4e3a-4894-a936-b5984a952520 消息时发生内部错误: name 'time' is not defined
Traceback (most recent call last):
  File "D:\资料\ALL IN AI\IDTAgent\IDT_Agent_Native\server.py", line 125, in process_chat_message
    start_time = time.monotonic()
NameError: name 'time' is not defined
